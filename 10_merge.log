-------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/echow/QSU/SEER-medicare/code/10_merge.log
  log type:  text
 opened on:   5 Jun 2018, 14:54:39

. local start = "$S_TIME"

. 
. * ------------------------------------------------------------------------------
. * SEER Medicare clean up
. * Eric Chow, 04-27-2017
. *
. * appends the 6 pedsf files that list all the cancer cases (cancer dgn file)
. * these files were obtained by running the SAS scripts provided by medicare
. * destring, and subsets the population.
. *
. * do the rhings from Baiyu's file. ie: 
. *    1. get only those w firdt dx == lung cancer, not just any dx of LC (use SITERWHO, seq1=00|01)
. *    2. keep if dgn in 2000-2013
. *    3. must be enerolled in medicar part A & B, & not in HMO in mnth of dgn
. *    4. keep only dgn from 2000-2013 - compare w SEER*medicare website
. * ------------------------------------------------------------------------------
. 
. set more off

. 
. clear 

. clear mata

. clear matrix

. set maxvar 10000 


. 
. use "/Volumes/QSU/Datasets/SEER_medicare/data/pedsf_analysis_long", clear

. 
. * how many first, second, third, and fourth lung cancers are there?
. tab seq_lc

        the |
sequence of |
lung cancer |
         in |
 2000-2013, |
   ie: 1 is |
  the first |
      LC in |
 2000-2013, |
         et |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    271,892       97.72       97.72
          2 |      6,028        2.17       99.89
          3 |        286        0.10       99.99
          4 |         18        0.01      100.00
------------+-----------------------------------
      Total |    278,224      100.00

. 
. * how many second lung cancers occur 5+ years after the first lung cancer?
. gen diag_dt2 = diag_dt if seq_lc == 2
(272,196 missing values generated)

. egen diag_dt2_ = min(diag_dt2), by(patient_id)
(265864 missing values generated)

. gen t_2nd_lc = diag_dt2_ - diag_dt if seq_lc == 1
(272,196 missing values generated)

. label var t_2nd_lc "days from first LC to second LC"

. // drop diag_dt2 diag_dt2_
. codebook t_2nd_lc

-------------------------------------------------------------------------------------------------------------
t_2nd_lc                                                                      days from first LC to second LC
-------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,4930]                     units:  1
         unique values:  522                      missing .:  272,196/278,224

                  mean:   819.606
              std. dev:   985.628

           percentiles:        10%       25%       50%       75%       90%
                                 0         0       425      1400      2312

. 
. * if 2nd LC occured 5+ years afte 1st, flag
. capture drop t_2nd_lc_flag

. gen t_2nd_lc_flag = (t_2nd_lc > 365.24*5)

. replace t_2nd_lc_flag = . if  missing(t_2nd_lc)
(272,196 real changes made, 272,196 to missing)

. 
. * how many of the 2nd lung cancers occurr 5+ years after?
. codebook t_2nd_lc_flag

-------------------------------------------------------------------------------------------------------------
t_2nd_lc_flag                                                                                     (unlabeled)
-------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  272,196/278,224

            tabulation:  Freq.  Value
                         5,027  0
                         1,001  1
                       272,196  .

. 
. 
. * ------------------------------------------------------------------
. * merge in the chronic conditions now, by patient ID and year of dgn
. gen bene_enrollmt_ref_yr = yrdx_

. merge m:1 patient_id bene_enrollmt_ref_yr using "/Volumes/QSU/Datasets/SEER_medicare/CCflag/CCflag_small.dt
> a"

    Result                           # of obs.
    -----------------------------------------
    not matched                    16,485,136
        from master                    89,904  (_merge==1)
        from using                 16,395,232  (_merge==2)

    matched                           188,320  (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

. drop if _merge == 2
(16,395,232 observations deleted)

. 
end of do-file

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

. drop _merge

. 
end of do-file

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

. drop bene_enrollmt_ref_yr

. 
end of do-file

. use "/Volumes/QSU/Datasets/SEER_medicare/medpar/medpar99.dta", clear

. use "/Volumes/QSU/Datasets/SEER_medicare/medpar/medpar91.dta"

. isid patient_id
variable patient_id does not uniquely identify the observations
r(459);

. isid patient_id adm_m adm_d adm_y
variables patient_id adm_m adm_d adm_y do not uniquely identify the observations
r(459);

. use "/Volumes/QSU/Datasets/SEER_medicare/medpar/medpar91.dta"

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

.         keep    patient_id age mdcrstat stdstate snfind ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y los  ///
>                         totchrgs cvrdchrg reimbamnt drgprice///
variable reimbamnt not found
r(111);

end of do-file

r(111);

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

.         keep    patient_id age mdcrstat stdstate snfind ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y los  ///
>                         totchrgs cvrdchrg reimbamt drgprice///
/ invalid name
r(198);

end of do-file

r(198);

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

.         keep    patient_id age mdcrstat stdstate snfind ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y los  ///
>                         totchrgs cvrdchrg reimbamt drgprice ///
>                         raddgind radthind nucmdind ctscnind oimsrind  ///
>                         numdxcde dgn_cd* surgind numsrgcd numsrgdt srgcde* sg_dt* ///
>                         drgcode discdest 

. 
end of do-file

. tab radthind

RADIOLOGY-T |
 HERAPEUTIC |
  INDICATOR |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,527       99.30       99.30
          1 |         25        0.70      100.00
------------+-----------------------------------
      Total |      3,552      100.00

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

.         quietly destring age mdcrstat stdstate snfind ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y   ///
>                         raddgind radthind nucmdind ctscnind oimsrind  ///
>                         numdxcde dgn_cd* surgind numsrgcd numsrgdt srgcde* sg_dt* ///
>                         drgcode discdest , replace

. 
end of do-file

. tab stdstate

 STATE CODE |      Freq.     Percent        Cum.
------------+-----------------------------------
         01 |          3        0.08        0.08
         02 |          2        0.06        0.14
         03 |          4        0.11        0.25
         04 |          1        0.03        0.28
         05 |         15        0.42        0.70
         06 |          1        0.03        0.73
         07 |      1,366       38.46       39.19
         09 |          1        0.03       39.22
         0{ |          2        0.06       39.27
         10 |         84        2.36       41.64
         11 |          4        0.11       41.75
         12 |         55        1.55       43.30
         14 |          5        0.14       43.44
         15 |          8        0.23       43.67
         17 |          1        0.03       43.69
         19 |          1        0.03       43.72
         21 |          5        0.14       43.86
         22 |         10        0.28       44.14
         23 |      1,878       52.87       97.02
         25 |          2        0.06       97.07
         26 |          1        0.03       97.10
         29 |          2        0.06       97.16
         30 |          3        0.08       97.24
         32 |          1        0.03       97.27
         33 |         46        1.30       98.56
         34 |          4        0.11       98.68
         36 |          9        0.25       98.93
         38 |          5        0.14       99.07
         39 |          4        0.11       99.18
         40 |          6        0.17       99.35
         41 |          3        0.08       99.44
         42 |          2        0.06       99.49
         44 |          1        0.03       99.52
         45 |          1        0.03       99.55
         47 |          2        0.06       99.61
         49 |          6        0.17       99.77
         50 |          4        0.11       99.89
         51 |          2        0.06       99.94
         52 |          2        0.06      100.00
------------+-----------------------------------
      Total |      3,552      100.00

. use "/Volumes/QSU/Datasets/SEER_medicare/medpar/medpar91.dta", clear

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

. 
.         keep    patient_id age mdcrstat stdstate snfind ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y los  ///
>                         totchrgs cvrdchrg reimbamt drgprice ///
>                         raddgind radthind nucmdind ctscnind oimsrind  ///
>                         numdxcde dgn_cd* surgind numsrgcd numsrgdt srgcde* sg_dt* ///
>                         drgcode discdest 

. 
.         quietly destring age mdcrstat stdstate  ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y   ///
>                         raddgind radthind nucmdind ctscnind oimsrind  ///
>                         numdxcde surgind numsrgcd numsrgdt srgcde* sg_dt* ///
>                         drgcode discdest , replace

. 
end of do-file

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

.         quietly destring age mdcrstat stdstate  ///
>                         adm_m adm_d adm_y   dis_m dis_d dis_y   ///
>                         raddgind radthind nucmdind ctscnind oimsrind  ///
>                         numdxcde surgind numsrgcd numsrgdt srgcde* sg_dt* ///
>                         drgcode discdest , replace force

. 
end of do-file

. do "/var/folders/x2/gkyq3hbx5219h68lwx_tsv540000gn/T//SD50707.000000"

. capture log close
